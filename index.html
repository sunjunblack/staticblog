<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>sunjunblack&#39;blog</title>
  <meta name="author" content="John Doe">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="sunjunblack&#39;blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">sunjunblack&#39;blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header">
  <h1>sunjunblack&#39;blog</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Yet another bootstrap theme.
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-19 </div>
			<div class="article-title"><a href="/2016/03/19/JDK源码阅读-StringBuffer类/" ></a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>title: JDK源码阅读-StringBuffer类<br>categories: Web开发<br>tags: [java]<br>date: 2016-03-18<br>toc: true</p>
<h1 id="JDK_u6E90_u7801_u9605_u8BFB-StringBuffer_u7C7B"><a href="#JDK_u6E90_u7801_u9605_u8BFB-StringBuffer_u7C7B" class="headerlink" title="JDK源码阅读-StringBuffer类"></a>JDK源码阅读-StringBuffer类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span></span><br><span class="line">   <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></span><br><span class="line">   <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>final类型，一旦创建不可改变.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>构造函数创建长度16的的char数组</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.append(String.valueOf(obj));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractStringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (str == <span class="keyword">null</span>) str = <span class="string">"null"</span>;</span><br><span class="line">       <span class="keyword">int</span> len = str.length();</span><br><span class="line">       ensureCapacityInternal(count + len);</span><br><span class="line">       str.getChars(<span class="number">0</span>, len, value, count);</span><br><span class="line">       count += len;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">expandCapacity</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> newCapacity = value.length * <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">if</span> (newCapacity - minimumCapacity &lt; <span class="number">0</span>)</span><br><span class="line">          newCapacity = minimumCapacity;</span><br><span class="line">      <span class="keyword">if</span> (newCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (minimumCapacity &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> OutOfMemoryError();</span><br><span class="line">          newCapacity = Integer.MAX_VALUE;</span><br><span class="line">      &#125;</span><br><span class="line">      value = Arrays.copyOf(value, newCapacity);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>StringBuffer中<code>append</code>方法，<br>1.当数组容量不足时，会通过<code>value.length * 2 + 2</code>算法进行扩容。<br>2.传入字符为Null时,会转换成字符”null”进行拼接</p>
</blockquote>

	
	</div>
  <a type="button" href="/2016/03/19/JDK源码阅读-StringBuffer类/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-19 </div>
			<div class="article-title"><a href="/2016/03/19/JDK源码阅读－String类/" ></a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>title: JDK源码阅读－String类<br>categories: Web开发<br>tags: [java]<br>date: 2016-03-15<br>toc: true</p>
<h1 id="JDK_u6E90_u7801_u9605_u8BFB_uFF0DString_u7C7B"><a href="#JDK_u6E90_u7801_u9605_u8BFB_uFF0DString_u7C7B" class="headerlink" title="JDK源码阅读－String类"></a>JDK源码阅读－String类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>final类型，一旦创建不可改变</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>底层使用char数组存储</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public String(String original) &#123;&#10;        this.value = original.value;&#10;        this.hash = original.hash;&#10;    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>new创建的新对象复制原值的Hash值，但不代表是同一内存地址。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public String(char value[]) &#123;&#10;        this.value = Arrays.copyOf(value, value.length);&#10;    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过char[]生成的字符是通过<code>Arrays.copyOf()</code>复制值实现的</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span> bytes[], String charsetName)</span></span><br><span class="line">            <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(bytes, <span class="number">0</span>, bytes.length, charsetName);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>底层是通过<code>StringCoding.decode(charset, bytes, offset, length)</code>实现的关于StringCoding类以后在详细分析</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(StringBuffer buffer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(buffer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.value = Arrays.copyOf(buffer.getValue(), buffer.length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>StringBuffer是线程安全的，所以通过<code>StringBuffer</code>创建String对象需要对其做同步<code>Synchronized</code>处理.<br>StringBuffer后续修改不影响新创建的对象。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(StringBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = Arrays.copyOf(builder.getValue(), builder.length());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于不需要做同步处理，所以速度上比较快，通常是优选<br>StringBuilder后续修改不影响新创建的对象。</p>
</blockquote>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] getBytes(String charsetName)</span><br><span class="line">           <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">       <span class="keyword">if</span> (charsetName == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">       <span class="function"><span class="keyword">return</span> StringCoding.<span class="title">encode</span><span class="params">(charsetName, value, <span class="number">0</span>, value.length)</span></span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>底层是通过<code>StringCoding.encode(charsetName, value, 0, value.length)</code>实现</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String anotherString = (String) anObject;</span><br><span class="line">            <span class="keyword">int</span> n = value.length;</span><br><span class="line">            <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">                <span class="keyword">char</span> v1[] = value;</span><br><span class="line">                <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以看出equals方法做了些性能优化。<br>判断步骤</p>
<ol>
<li>是否是同一个对象，如相同直接返回true;</li>
<li>是否是String对象的实类.</li>
<li>字符长度是否相等.</li>
<li>相同位置字符是否相等<br><strong>注意</strong>：步骤2会对比较字符(参数字符)做对象校验，被比较字符(当前对象字符)不做任何处理直接通过循环字符数组比较。所以Equals比较要把变量放到右边.</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equalsIgnoreCase</span><span class="params">(String anotherString)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (<span class="keyword">this</span> == anotherString) ? <span class="keyword">true</span></span><br><span class="line">               : (anotherString != <span class="keyword">null</span>)</span><br><span class="line">               &amp;&amp; (anotherString.value.length == value.length)</span><br><span class="line">               &amp;&amp; regionMatches(<span class="keyword">true</span>, <span class="number">0</span>, anotherString, <span class="number">0</span>, value.length);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">regionMatches</span><span class="params">(<span class="keyword">boolean</span> ignoreCase, <span class="keyword">int</span> toffset,</span><br><span class="line">         String other, <span class="keyword">int</span> ooffset, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">char</span> ta[] = value;</span><br><span class="line">     <span class="keyword">int</span> to = toffset;</span><br><span class="line">     <span class="keyword">char</span> pa[] = other.value;</span><br><span class="line">     <span class="keyword">int</span> po = ooffset;</span><br><span class="line">     <span class="comment">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">     <span class="keyword">if</span> ((ooffset &lt; <span class="number">0</span>) || (toffset &lt; <span class="number">0</span>)</span><br><span class="line">             || (toffset &gt; (<span class="keyword">long</span>)value.length - len)</span><br><span class="line">             || (ooffset &gt; (<span class="keyword">long</span>)other.value.length - len)) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">while</span> (len-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">char</span> c1 = ta[to++];</span><br><span class="line">         <span class="keyword">char</span> c2 = pa[po++];</span><br><span class="line">         <span class="keyword">if</span> (c1 == c2) &#123;</span><br><span class="line">             <span class="keyword">continue</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span> (ignoreCase) &#123;</span><br><span class="line">             <span class="comment">// If characters don't match but case may be ignored,</span></span><br><span class="line">             <span class="comment">// try converting both characters to uppercase.</span></span><br><span class="line">             <span class="comment">// If the results match, then the comparison scan should</span></span><br><span class="line">             <span class="comment">// continue.</span></span><br><span class="line">             <span class="keyword">char</span> u1 = Character.toUpperCase(c1);</span><br><span class="line">             <span class="keyword">char</span> u2 = Character.toUpperCase(c2);</span><br><span class="line">             <span class="keyword">if</span> (u1 == u2) &#123;</span><br><span class="line">                 <span class="keyword">continue</span>;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="comment">// Unfortunately, conversion to uppercase does not work properly</span></span><br><span class="line">             <span class="comment">// for the Georgian alphabet, which has strange rules about case</span></span><br><span class="line">             <span class="comment">// conversion.  So we need to make one last check before</span></span><br><span class="line">             <span class="comment">// exiting.</span></span><br><span class="line">             <span class="keyword">if</span> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) &#123;</span><br><span class="line">                 <span class="keyword">continue</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>equalsIgnoreCase</code>方法底层是通过regionMatches方法实现的。<br>关于regionMatches方法对于忽略大小写判断的代码.由于格鲁吉亚字符无法通过转换成大写判断相同。还需再通过一次转换小写判断才行.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix, <span class="keyword">int</span> toffset)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ta[] = value;</span><br><span class="line">    <span class="keyword">int</span> to = toffset;</span><br><span class="line">    <span class="keyword">char</span> pa[] = prefix.value;</span><br><span class="line">    <span class="keyword">int</span> po = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pc = prefix.value.length;</span><br><span class="line">    <span class="comment">// Note: toffset might be near -1&gt;&gt;&gt;1.</span></span><br><span class="line">    <span class="keyword">if</span> ((toffset &lt; <span class="number">0</span>) || (toffset &gt; value.length - pc)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (--pc &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ta[to++] != pa[po++]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要说明的是使用方法前需要对当前字符对象做Null校验，否则会出现NullPointerException.<br>对于此类的字符操作建议使用apache commons.lang包的StringUtils类。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span><br><span class="line">        <span class="keyword">char</span>[] target, <span class="keyword">int</span> targetOffset, <span class="keyword">int</span> targetCount,</span><br><span class="line">        <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fromIndex &gt;= sourceCount) &#123;</span><br><span class="line">        <span class="keyword">return</span> (targetCount == <span class="number">0</span> ? sourceCount : -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (fromIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        fromIndex = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (targetCount == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fromIndex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> first = target[targetOffset];</span><br><span class="line">    <span class="keyword">int</span> max = sourceOffset + (sourceCount - targetCount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = sourceOffset + fromIndex; i &lt;= max; i++) &#123;</span><br><span class="line">        <span class="comment">/* Look for first character. */</span></span><br><span class="line">        <span class="keyword">if</span> (source[i] != first) &#123;</span><br><span class="line">            <span class="keyword">while</span> (++i &lt;= max &amp;&amp; source[i] != first);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Found first character, now look at the rest of v2 */</span></span><br><span class="line">        <span class="keyword">if</span> (i &lt;= max) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> end = j + targetCount - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = targetOffset + <span class="number">1</span>; j &lt; end &amp;&amp; source[j]</span><br><span class="line">                    == target[k]; j++, k++);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (j == end) &#123;</span><br><span class="line">                <span class="comment">/* Found whole string. */</span></span><br><span class="line">                <span class="keyword">return</span> i - sourceOffset;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>indexOf方法原理是先找到首匹配字符，然后逐个比较。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">substring</span><span class="params">(<span class="keyword">int</span> beginIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(beginIndex);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(endIndex);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">int</span> subLen = endIndex - beginIndex;</span><br><span class="line">       <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> StringIndexOutOfBoundsException(subLen);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="keyword">this</span></span><br><span class="line">               : <span class="keyword">new</span> String(value, beginIndex, subLen);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>substring是new一个新对象通过字符数组截取实现的 </p>
</blockquote>

	
	</div>
  <a type="button" href="/2016/03/19/JDK源码阅读－String类/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-13 </div>
			<div class="article-title"><a href="/2016/03/13/ORACLE 分析函数/" >ORACLE 分析函数</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="ORACLE__u5206_u6790_u51FD_u6570"><a href="#ORACLE__u5206_u6790_u51FD_u6570" class="headerlink" title="ORACLE 分析函数"></a>ORACLE 分析函数</h1><h2 id="u8BED_u6CD5"><a href="#u8BED_u6CD5" class="headerlink" title="语法"></a>语法</h2><p>FUNCTION_NAME(\<argument>,\<argument>…)<br>OVER<br>(\<partition-clause>\<order-by-clause>\<windowing-clause>)</windowing-clause></order-by-clause></partition-clause></argument></argument></p>
<p><strong><code>FUNCTION_NAME</code></strong> : 函数名称<br><strong><code>argument</code></strong> : 函数参数<br><strong><code>OVER</code></strong> : 关键字,用于标识分析函数<br><strong><code>Partition-Clause</code></strong> : 可选的分区子句,如果不存在任何分区子句,则全部的结果集可看作一个分区<br><strong><code>Order-by-Clause</code></strong> : 可选排序字句,对分区数据结果进行排序<br><strong><code>Windowing-Clause</code></strong> : 可选窗口范围字句,对分区内结果集进行过滤</p>
<h2 id="u5B9E_u4F8B"><a href="#u5B9E_u4F8B" class="headerlink" title="实例"></a>实例</h2><p><strong>订单表</strong> t_orders</p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>DESCR</th>
</tr>
</thead>
<tbody>
<tr>
<td>CUST_NBR</td>
<td>客户</td>
</tr>
<tr>
<td>REGION_ID</td>
<td>区域ID</td>
</tr>
<tr>
<td>SALESPERSON_ID</td>
<td>销售人员ID</td>
</tr>
<tr>
<td>YEAR</td>
<td>订单年份</td>
</tr>
<tr>
<td>MONTH</td>
<td>订单月份</td>
</tr>
<tr>
<td>TOT_ORDERS</td>
<td>销售订单</td>
</tr>
<tr>
<td>TOT_SALES</td>
<td>销售金额</td>
</tr>
</tbody>
</table>
<p>1.查询2015年度每个客户及其对应区域的订单总额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> o.cust_nbr customer,</span><br><span class="line">		o.region_id region,</span><br><span class="line">		<span class="keyword">SUM</span>(o.tot_sales) cust_sales,</span><br><span class="line">		<span class="keyword">SUM</span>(<span class="keyword">SUM</span>(o.tot_sales)) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> o.region_id) region_sales</span><br><span class="line">		<span class="keyword">FROM</span> t_orders o</span><br><span class="line">		<span class="keyword">WHERE</span> o.<span class="keyword">year</span>=<span class="number">2015</span></span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> o.region_id, o.cust_nbr;</span></span><br></pre></td></tr></table></figure>
<p>2.按区域查找2015年度订单总额占区域订单总额20%以上的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> sales.*,</span><br><span class="line">	<span class="number">100</span>*<span class="keyword">round</span>(cust_sales/region_sales,<span class="number">2</span>)||<span class="string">'%'</span> <span class="keyword">Percent</span></span><br><span class="line">	<span class="keyword">FROM</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> o.cust_nbr customer,</span><br><span class="line">		o.region_id region,</span><br><span class="line">		<span class="keyword">SUM</span>(o.tot_sales) cust_sales,</span><br><span class="line">		<span class="keyword">SUM</span>(<span class="keyword">SUM</span>(o.tot_sales)) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> o.region_id) region_sales</span><br><span class="line">		<span class="keyword">FROM</span> t_orders o</span><br><span class="line">		<span class="keyword">WHERE</span> o.<span class="keyword">year</span>=<span class="number">2015</span></span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> o.region_id, o.cust_nbr) sales</span><br><span class="line">	<span class="keyword">WHERE</span> sales.cust_sales &gt; sales.region_sales * <span class="number">0.2</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明：<br>1.Over函数指明在那些字段上做分析，其内跟Partition by表示对数据进行分组。注意Partition by可以有多个字段。<br>2.Over函数可以和其它聚集函数、分析函数搭配，起到不同的作用。例如这里的SUM，还有诸如Rank，Dense_rank等。</p>
</blockquote>
<p>3.对所有客户按订单总额进行排名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id, </span><br><span class="line">	customer_id,</span><br><span class="line">	<span class="keyword">SUM</span>(customer_sales) total,</span><br><span class="line">	<span class="keyword">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span>) <span class="keyword">rank</span></span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, customer_id;</span></span><br></pre></td></tr></table></figure>
<p>4.按区域和客户订单总额进行排名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id, </span><br><span class="line">	customer_id,</span><br><span class="line">	<span class="keyword">SUM</span>(customer_sales) total,</span><br><span class="line">	<span class="keyword">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> region_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span>) <span class="keyword">rank</span></span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, customer_id;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>ROW_NUMBER</code></em>:函数返回一个唯一的值，当碰到相同数据时，排名按照记录集中记录的顺序依次递增<br><em><code>RANK</code></em>:函数返回一个唯一的值，除非遇到相同的数据时，此时所有相同数据的排名是一样的，同时会在最后一条相同记录和下一条不同记录的排名之间空出排名<br><em><code>DENSE_RANK</code></em>：函数返回一个唯一的值，除非当碰到相同数据时，此时所有相同数据的排名都是一样的。</p>
</blockquote>
<p>5.找出订单总额排名前3位的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id, </span><br><span class="line">	customer_id,</span><br><span class="line">	<span class="keyword">SUM</span>(customer_sales) total,</span><br><span class="line">	<span class="keyword">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span> <span class="keyword">NULLS</span> <span class="keyword">LAST</span>) <span class="keyword">rank</span></span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, customer_id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">rank</span> &lt;= <span class="number">3</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>NULLS LAST</code></em>:空值排名最后<br><em><code>NULLS FIRST</code></em>:空值排名最前</p>
</blockquote>
<p>6.找出订单总额最高、最低的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(customer_id)</span><br><span class="line">	<span class="keyword">KEEP</span> (<span class="keyword">DENSE_RANK</span> <span class="keyword">FIRST</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span>) <span class="keyword">first</span>,</span><br><span class="line">		<span class="keyword">MIN</span>(customer_id)</span><br><span class="line">	<span class="keyword">KEEP</span> (<span class="keyword">DENSE_RANK</span> <span class="keyword">LAST</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span>) <span class="keyword">last</span></span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_id;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>MIN</code></em>:在这里作用是当存在多条记录时，返回唯一纪录<br><em><code>KEEP</code></em>:保留符合条件的记录<br><em><code>DENSE_RANK</code></em>:排序策略不能被RANK替代<br><em><code>FIRST</code></em>:筛选条件取第一个<br><em><code>LAST</code></em>:筛选条件取做后一个</p>
</blockquote>
<p>7.找出订单总额排名前25%的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id,</span><br><span class="line">	customer_id,</span><br><span class="line">	 NTILE(<span class="number">4</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(customer_sales) <span class="keyword">DESC</span>) til</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, customer_id</span><br><span class="line">til = <span class="number">1</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>NTILE(N)</code></em>:记录集中的排名计算比例,所有的记录被分成N个等级.</p>
</blockquote>
<p>8.列出每月的订单总额以及全年的订单总额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">month</span>,</span><br><span class="line">	<span class="keyword">SUM</span>(tot_sales) month_sales,</span><br><span class="line">	<span class="keyword">SUM</span>(<span class="keyword">SUM</span>(tot_sales)) </span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">unbounded</span> <span class="keyword">preceding</span> <span class="keyword">AND</span> <span class="keyword">unbounded</span> <span class="keyword">following</span>) total_sales</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>ROWS</code></em>:窗口子句，是在分组(PARTITION BY)后，组内的子分组（也称窗口）.此时分析函数的计算范围窗口，而不是PARTITON。窗口有两种，ROWS和RANGE；<br><strong><code>unbounded</code></strong>: 不受控制的，无限的<br><strong><code>preceding</code></strong>: 在…之前<br><strong><code>following</code></strong>: 在…之后</p>
</blockquote>
<p>9.列出每月的订单总额以及截至到当前月的订单总额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">month</span>,</span><br><span class="line">	<span class="keyword">SUM</span>(tot_sales) month_sales,</span><br><span class="line">	<span class="keyword">SUM</span>(<span class="keyword">SUM</span>(tot_sales)) </span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="keyword">unbounded</span> <span class="keyword">preceding</span> <span class="keyword">AND</span> <span class="keyword">current</span> <span class="keyword">row</span>) current_total_sales</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>current row</code></em>:当前记录行</p>
</blockquote>
<p>10.指定范围统计当天销售额和五天内的评价销售额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> TRUNC(order_dt) <span class="keyword">day</span>,</span><br><span class="line">	<span class="keyword">SUM</span>(sale_price) daily_sales,</span><br><span class="line">	<span class="keyword">AVG</span>(<span class="keyword">SUM</span>(sale_price)) </span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> TRUNC(order_dt) <span class="keyword">RANGE</span> <span class="keyword">BETWEEN</span> <span class="built_in">INTERVAL</span> <span class="string">'2'</span> <span class="keyword">DAY</span> <span class="keyword">preceding</span></span><br><span class="line">	<span class="keyword">AND</span> <span class="built_in">INTERVAL</span> <span class="string">'2'</span> <span class="keyword">DAY</span> <span class="keyword">following</span>) five_day_avg</span><br><span class="line"><span class="keyword">FROM</span> cust_order</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>RANGE</code></em>: 窗口子句，是在分组(PARTITION BY)后，组内的子分组（也称窗口）.此时分析函数的计算范围窗口，而不是PARTITON。窗口有两种，ROWS和RANGE；<br><em><code>ROWS与RANGE区别</code></em>:<br>－range是逻辑窗口，是指定当前行对应值的范围取值，列数不固定，只要行值在范围内，对应列都包含在内<br>－rows是物理窗口，即根据order by 子句排序后，取的前N行及后N行的数据计算（与当前行的值无关，只与排序后的行号相关）</p>
</blockquote>
<p>11.显示当前月、上一个月、后一个月的销售情况，以及每3个月的销售平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">month</span>,</span><br><span class="line">	<span class="keyword">FIRST_VALUE</span>(<span class="keyword">SUM</span>(tot_sales))</span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">preceding</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">following</span>) prev_month,</span><br><span class="line">	<span class="keyword">LAST_VALUE</span>(<span class="keyword">SUM</span>(tot_sales))</span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">preceding</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">following</span>) next_month,</span><br><span class="line">	<span class="keyword">AVG</span>(<span class="keyword">SUM</span>(tot_sales))</span><br><span class="line">	<span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">1</span> <span class="keyword">preceding</span> <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">following</span>) rolling_avg</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span>=<span class="number">2015</span> <span class="keyword">and</span> region_id =<span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>FIRST_VALUE</code></em>: 在窗口记录集中查找第一条记录<br><em><code>LAST_VALUE</code></em>: 在窗口记录集中查找最后一条记录</p>
</blockquote>
<p>12.显示当月的销售额和上个月的销售额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">month</span>,</span><br><span class="line">	<span class="keyword">SUM</span>(tot_sales) monthly_sales,</span><br><span class="line">	LAG(<span class="keyword">SUM</span>(tot_sales),<span class="number">1</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span>) prev_month_sales</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span>=<span class="number">2015</span> <span class="keyword">AND</span> region_id=<span class="number">6</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">month</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>LAG(exp_str,offset,defval)</code></em>: 在同一次查询中取出同一字段的前N行的数据作为独立列<br><em><code>LEAD(exp_str,offset,defval)</code></em>: 在同一次查询中取出同一字段的后N行的数据作为独立列</p>
</blockquote>
<p>13.列出上一年度每个月的销售总额、年底销售额以及每个月的销售额占全年总销售额的比例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id,salesperson_id,</span><br><span class="line">	<span class="keyword">SUM</span>(tot_sales) sp_sales,</span><br><span class="line">	<span class="keyword">ROUND</span>(<span class="keyword">SUM</span>(tot_sales)/<span class="keyword">SUM</span>(<span class="keyword">SUM</span>(tot_sales)) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> region_id),<span class="number">2</span>) percent_of_region</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span>=<span class="number">2015</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, salesperson_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> region_id, salesperson_id</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SELECT</span> region_id,salesperson_id,</span><br><span class="line">	<span class="keyword">SUM</span>(tot_sales) sp_sales,</span><br><span class="line">	<span class="keyword">ROUND</span>(ratio_to_report(<span class="keyword">SUM</span>(tot_sales)) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> region_id),<span class="number">2</span>) sp_ratio</span><br><span class="line"><span class="keyword">FROM</span> t_orders</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">year</span>=<span class="number">2015</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> region_id, salesperson_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> region_id, salesperson_id</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>说明:<br><em><code>ratio_to_report</code></em>: 允许我们计算每条记录在其对应记录集或其子集中所占的比例.</p>
</blockquote>

	
	</div>
  <a type="button" href="/2016/03/13/ORACLE 分析函数/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/Nginx使用指南(四)/" >Nginx使用指南(四) 反向代理与负载均衡</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Nginx_u4F7F_u7528_u6307_u5357_28_u56DB_29__u53CD_u5411_u4EE3_u7406_u4E0E_u8D1F_u8F7D_u5747_u8861"><a href="#Nginx_u4F7F_u7528_u6307_u5357_28_u56DB_29__u53CD_u5411_u4EE3_u7406_u4E0E_u8D1F_u8F7D_u5747_u8861" class="headerlink" title="Nginx使用指南(四) 反向代理与负载均衡"></a>Nginx使用指南(四) 反向代理与负载均衡</h1><h2 id="u53CD_u5411_u4EE3_u7406"><a href="#u53CD_u5411_u4EE3_u7406" class="headerlink" title="反向代理"></a>反向代理</h2><h3 id="u6307_u4EE4"><a href="#u6307_u4EE4" class="headerlink" title="指令"></a>指令</h3><p><strong>proxy_pass 指令</strong></p>
<blockquote>
<p>使用环境:    location, if in location, limit_except<br>语法:    proxy_pass URL;<br>功能:    设置反向代理代理服务器地址(http or https)</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">location</span> / &#123;</span><br><span class="line">        <span class="comment">#设置主机头和客户端真实地址，以便服务器获取客户端真实IP</span></span><br><span class="line">        <span class="title">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="title">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="title">proxy_set_header</span> REMOTE-HOST <span class="variable">$remote_addr</span>;</span><br><span class="line">        <span class="title">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#设置反向代理的地址</span></span><br><span class="line">		<span class="title">proxy_pass</span> <span class="url">http://192.168.1.1</span>;       </span><br><span class="line"></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p><strong>proxy_redirect 指令</strong></p>
<blockquote>
<p>使用环境:    server, location, if<br>语法:         proxy_redirect [default | off | redirect replacement ]<br>功能:    对发送给客户端的URL进行修改</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">      <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">      <span class="title">server_name</span>  test.abc.com;</span><br><span class="line">      <span class="title">proxy_redirect</span> <span class="url">http://test.abc.com:9080/</span> /;</span><br><span class="line">      <span class="title">location</span> / &#123;</span><br><span class="line">          <span class="title">proxy_pass</span> <span class="url">http://10.10.10.1:9080</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>proxy_redirect指令把返回给浏览器地址中 <code>http://test.abc.com:9080/</code> 替换为 <code>／</code></p>
<hr>
<h2 id="u8D1F_u8F7D_u5747_u8861"><a href="#u8D1F_u8F7D_u5747_u8861" class="headerlink" title="负载均衡"></a>负载均衡</h2><h3 id="u6307_u4EE4-1"><a href="#u6307_u4EE4-1" class="headerlink" title="指令"></a>指令</h3><p><strong>upstream 指令</strong></p>
<blockquote>
<p>使用环境:    http<br>语法:    upstream name { … }<br>功能:    定义一组服务器</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> backend &#123;</span><br><span class="line">    <span class="title">server</span> backend1.example.com       weight=<span class="number">5</span>;</span><br><span class="line">    <span class="title">server</span> backend2.example.com:<span class="number">8080</span>;</span><br><span class="line">    <span class="title">server</span> <span class="url">unix:/tmp/backend3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title">server</span> backup1.example.com:<span class="number">8080</span>   backup;</span><br><span class="line">    <span class="title">server</span> backup2.example.com:<span class="number">8080</span>   backup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">server</span> &#123;</span><br><span class="line">    <span class="title">location</span> / &#123;</span><br><span class="line">        <span class="title">proxy_pass</span> <span class="url">http://backend</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u8D1F_u8F7D_u7B56_u7565"><a href="#u8D1F_u8F7D_u7B56_u7565" class="headerlink" title="负载策略"></a>负载策略</h3><p><strong>轮询(默认)</strong><br>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。 </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> backserver &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.14</span>;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.15</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>指定权重</strong><br>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> backserver &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.14</span> weight=<span class="number">5</span>;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.15</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>IP绑定</strong><br>每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	ip_hash;</span><br><span class="line">	server 192.168.0.14:88;</span><br><span class="line">	server 192.168.0.15:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>变量负载</strong><br>每个请求按访问变量值的hash结果分配。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> backserver &#123;</span><br><span class="line">	<span class="title">hash</span> <span class="string">"<span class="variable">$cookie_uid</span>"</span>;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.14:88</span>;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.0.15:80</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Fair（第三方）</strong><br>按后端服务器的响应时间来分配请求，响应时间短的优先分配。 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backserver &#123;</span><br><span class="line">	server server1;</span><br><span class="line">	server server2;</span><br><span class="line">	fair; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>url_hash（第三方）</strong><br>按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。  </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> backserver &#123;</span><br><span class="line">	<span class="title">server</span> squid1:<span class="number">3128</span>;</span><br><span class="line">	<span class="title">server</span> squid2:<span class="number">3128</span>;</span><br><span class="line">	<span class="title">hash</span> <span class="variable">$request_uri</span>;</span><br><span class="line">	<span class="title">hash_method</span> crc32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2016/03/09/Nginx使用指南(四)/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-07 </div>
			<div class="article-title"><a href="/2016/03/07/Nginx使用指南(三)/" >Nginx使用指南(三) Rewrite</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Nginx_u4F7F_u7528_u6307_u5357_28_u4E09_29_Rewrite"><a href="#Nginx_u4F7F_u7528_u6307_u5357_28_u4E09_29_Rewrite" class="headerlink" title="Nginx使用指南(三) Rewrite"></a>Nginx使用指南(三) Rewrite</h1>
	
	</div>
  <a type="button" href="/2016/03/07/Nginx使用指南(三)/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-04 </div>
			<div class="article-title"><a href="/2016/03/04/Nginx使用指南(二)/" >Nginx使用指南(二) Nginx服务启动脚本</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Nginx_u4F7F_u7528_u6307_u5357_28_u4E8C_29_Nginx_u670D_u52A1_u542F_u52A8_u811A_u672C"><a href="#Nginx_u4F7F_u7528_u6307_u5357_28_u4E8C_29_Nginx_u670D_u52A1_u542F_u52A8_u811A_u672C" class="headerlink" title="Nginx使用指南(二) Nginx服务启动脚本"></a>Nginx使用指南(二) Nginx服务启动脚本</h1>
	
	</div>
  <a type="button" href="/2016/03/04/Nginx使用指南(二)/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-02 </div>
			<div class="article-title"><a href="/2016/03/02/Nginx使用指南(一)/" >Nginx使用指南(一) CentOS 7 安装 Nginx 1.9.5</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Nginx_u4F7F_u7528_u6307_u5357_28_u4E00_29_CentOS_7__u5B89_u88C5_Nginx_1-9-5"><a href="#Nginx_u4F7F_u7528_u6307_u5357_28_u4E00_29_CentOS_7__u5B89_u88C5_Nginx_1-9-5" class="headerlink" title="Nginx使用指南(一) CentOS 7 安装 Nginx 1.9.5"></a>Nginx使用指南(一) CentOS 7 安装 Nginx 1.9.5</h1><h2 id="u5B89_u88C5_u4F9D_u8D56_u5305"><a href="#u5B89_u88C5_u4F9D_u8D56_u5305" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ autoconf automake&#10;yum -y install zlib zlib-devel openssl openssl-devel pcre-devel</span><br></pre></td></tr></table></figure>
<p>说明:<br><code>pcre</code>: 用来作地址重写的功能。<br><code>zlib</code>：nginx 的gzip模块,传输数据打包，省流量（但消耗资源）。<br><code>openssl</code>：提供ssl加密协议。</p>
<h2 id="u521B_u5EFA_u7528_u6237_u53CA_u7528_u6237_u7EC4"><a href="#u521B_u5EFA_u7528_u6237_u53CA_u7528_u6237_u7EC4" class="headerlink" title="创建用户及用户组"></a>创建用户及用户组</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd -r nginx&#10;useradd -s /sbin/nologin -g nginx -r nginx</span><br></pre></td></tr></table></figure>
<h2 id="u4E0B_u8F7D_u5E76_u89E3_u538BNginx"><a href="#u4E0B_u8F7D_u5E76_u89E3_u538BNginx" class="headerlink" title="下载并解压Nginx"></a>下载并解压Nginx</h2><p>下载地址：<a href="http://nginx.org/en/download.html" target="_blank" rel="external">http://nginx.org/en/download.html</a><br>解压下载包</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.9.2.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="u7F16_u8BD1_u5B89_u88C5"><a href="#u7F16_u8BD1_u5B89_u88C5" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure \&#10;--prefix=/etc/nginx \&#10;--sbin-path=/usr/sbin/nginx \&#10;--conf-path=/etc/nginx/nginx.conf \&#10;--error-log-path=/var/log/nginx/error.log \&#10;--http-log-path=/var/log/nginx/access.log \&#10;--pid-path=/var/run/nginx.pid \&#10;--lock-path=/var/run/nginx.lock \&#10;--http-client-body-temp-path=/var/cache/nginx/client_temp \&#10;--http-proxy-temp-path=/var/cache/nginx/proxy_temp \&#10;--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \&#10;--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \&#10;--http-scgi-temp-path=/var/cache/nginx/scgi_temp \&#10;--user=nginx \&#10;--group=nginx \&#10;--with-http_ssl_module \&#10;--with-http_realip_module \&#10;--with-http_addition_module \&#10;--with-http_sub_module \&#10;--with-http_dav_module \&#10;--with-http_flv_module \&#10;--with-http_mp4_module \&#10;--with-http_gunzip_module \&#10;--with-http_gzip_static_module \&#10;--with-http_random_index_module \&#10;--with-http_secure_link_module \&#10;--with-http_stub_status_module \&#10;--with-http_auth_request_module \&#10;--with-mail \&#10;--with-mail_ssl_module \&#10;--with-file-aio \&#10;--with-ipv6 \&#10;--with-http_v2_module \&#10;--with-cc-opt=&#39;-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &#38;&#38; make install</span><br></pre></td></tr></table></figure>
<h2 id="u542F_u52A8Nginx"><a href="#u542F_u52A8Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<h2 id="u547D_u4EE4_u53C2_u6570"><a href="#u547D_u4EE4_u53C2_u6570" class="headerlink" title="命令参数"></a>命令参数</h2><p><code>-c</code> 配置文件路径<br><code>-t</code> 检测配置文件<br><code>-v</code> 显示版本<br><code>-V</code> 显示编译环境信息以及编译时的参数<br><code>-g</code>    设置全局指令</p>

	
	</div>
  <a type="button" href="/2016/03/02/Nginx使用指南(一)/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-02-06 </div>
			<div class="article-title"><a href="/2016/02/06/POI深入研究－单元格Cell/" >POI深入研究－单元格Cell</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="POI_u6DF1_u5165_u7814_u7A76_uFF0D_u5355_u5143_u683CCell"><a href="#POI_u6DF1_u5165_u7814_u7A76_uFF0D_u5355_u5143_u683CCell" class="headerlink" title="POI深入研究－单元格Cell"></a>POI深入研究－单元格Cell</h1><h2 id="u73AF_u5883"><a href="#u73AF_u5883" class="headerlink" title="环境"></a>环境</h2><p>MS Excel: 2016<br>Apache POI: 3.13</p>
<h2 id="Cell_u7C7B_u578B"><a href="#Cell_u7C7B_u578B" class="headerlink" title="Cell类型"></a>Cell类型</h2><p>在 org.apache.poi.ss.usermodel.Cell 接口中</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>变量</th>
<th>数值</th>
</tr>
</thead>
<tbody>
<tr>
<td>数字</td>
<td>CELL_TYPE_NUMERIC</td>
<td>0</td>
</tr>
<tr>
<td>字符</td>
<td>CELL_TYPE_STRING</td>
<td>1</td>
</tr>
<tr>
<td>公式</td>
<td>CELL_TYPE_FORMULA</td>
<td>2</td>
</tr>
<tr>
<td>空值</td>
<td>CELL_TYPE_BLANK</td>
<td>3</td>
</tr>
<tr>
<td>布尔</td>
<td>CELL_TYPE_BOOLEAN</td>
<td>4</td>
</tr>
<tr>
<td>错误</td>
<td>CELL_TYPE_ERROR</td>
<td>5</td>
</tr>
</tbody>
</table>
<h2 id="u5B9E_u9A8C"><a href="#u5B9E_u9A8C" class="headerlink" title="实验"></a>实验</h2><p>通过设置不同值和设置不同Excel单元格类型，使用<code>getCellType()</code>方法得到类型的返回值</p>
<table>
<thead>
<tr>
<th>单元格类型</th>
<th>原始值</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>常规</td>
<td>100000</td>
<td>0</td>
</tr>
<tr>
<td>数值</td>
<td>100000</td>
<td>0</td>
</tr>
<tr>
<td>科学计数</td>
<td>100000</td>
<td>0</td>
</tr>
<tr>
<td>文本</td>
<td>100000</td>
<td>1</td>
</tr>
<tr>
<td>日期</td>
<td>2016/6/6</td>
<td>0</td>
</tr>
<tr>
<td>文本</td>
<td>2016/6/6</td>
<td>1</td>
</tr>
<tr>
<td>常规</td>
<td>999.028729</td>
<td>0</td>
</tr>
<tr>
<td>常规</td>
<td>1000a</td>
<td>1</td>
</tr>
<tr>
<td>常规</td>
<td></td>
<td>3</td>
</tr>
<tr>
<td>公式</td>
<td>A1-G1</td>
<td>2</td>
</tr>
<tr>
<td>常规</td>
<td>false</td>
<td>4</td>
</tr>
</tbody>
</table>
<blockquote>
<p>总结：</p>
<ol>
<li>在Excel单元格为默认常规的情况下，返回类型只跟单员元格内容有关.<ol>
<li>日期和数值返回 CELL_TYPE_NUMERIC</li>
<li>文本返回 CELL_TYPE_STRING</li>
<li>公式返回 CELL_TYPE_FORMULA</li>
<li>空值返回 CELL_TYPE_BLANK</li>
<li>布尔返回 CELL_TYPE_BOOLEAN</li>
</ol>
</li>
<li>单元格为文本的情况下 常规输入日期，数字，字符，布尔都返回  CELL_TYPE_STRING<br>3.对于常规单元格内容为日期，整数，浮点数都属于CELL_TYPE_NUMERIC类型。日期类型可通过HSSFDateUtil.isCellDateFormatted(cell)判断；整数与浮点数通过getNumericCellValue<br>获取返回的Double类型数字，整型需要把Double转换成整型数字。</li>
</ol>
</blockquote>
<p>##单元格读取方法API例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCellValue</span><span class="params">(XSSFCell cell)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cell == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            String cellValue = <span class="string">""</span>;</span><br><span class="line">            SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">            <span class="keyword">switch</span> (cell.getCellType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> XSSFCell.CELL_TYPE_STRING:</span><br><span class="line">                cellValue = cell.getRichStringCellValue().getString().trim();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> XSSFCell.CELL_TYPE_NUMERIC:</span><br><span class="line">                <span class="keyword">if</span> (HSSFDateUtil.isCellDateFormatted(cell)) &#123;</span><br><span class="line">                    Date d = cell.getDateCellValue();</span><br><span class="line">                    cellValue = sdf.format(d);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                	<span class="keyword">double</span> doubleVal = cell.getNumericCellValue();</span><br><span class="line">					<span class="keyword">long</span> longVal = Math.round(cell.getNumericCellValue());  </span><br><span class="line">				    <span class="keyword">if</span>(Double.parseDouble(longVal + <span class="string">".0"</span>) == doubleVal)&#123;</span><br><span class="line">				    	cellValue = String.valueOf(longVal);  </span><br><span class="line">				    &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">				    	cellValue = String.valueOf(doubleVal);</span><br><span class="line">				    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> XSSFCell.CELL_TYPE_BOOLEAN:</span><br><span class="line">                cellValue = String.valueOf(cell.getBooleanCellValue()).trim();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> XSSFCell.CELL_TYPE_FORMULA:</span><br><span class="line">            	cellValue = String.valueOf(cell.getNumericCellValue());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                cellValue = <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> cellValue;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2016/02/06/POI深入研究－单元格Cell/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-02-04 </div>
			<div class="article-title"><a href="/2016/02/04/设计模式－抽象工厂Abstract Factory/" >设计模式－抽象工厂Abstract Factory</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="u6A21_u5F0F_u5B9A_u4E49"><a href="#u6A21_u5F0F_u5B9A_u4E49" class="headerlink" title="模式定义"></a>模式定义</h2><p>抽象工厂模式提供一个接口，用于创建相关或者依赖对象的家族，而不需要明确指定具体类。</p>
<h2 id="u6A21_u5F0F_u7ED3_u6784"><a href="#u6A21_u5F0F_u7ED3_u6784" class="headerlink" title="模式结构"></a>模式结构</h2><p><img src="http://7xqe0b.com1.z0.glb.clouddn.com/2016-02-04-14545902940670.jpg" alt=""></p>
<h2 id="u6A21_u5F0F_u5B9E_u73B0"><a href="#u6A21_u5F0F_u5B9E_u73B0" class="headerlink" title="模式实现"></a>模式实现</h2><p><strong>工厂接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PizzaIngredientFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 在接口中，每个原料都有一个对应的方法创建该原料</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dough <span class="title">createDough</span><span class="params">()</span></span>;    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cheese <span class="title">createCheese</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Veggies[] createVeggies();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pepperoni <span class="title">createPepperoni</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Clams <span class="title">createClams</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>具体工厂实现类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYPizzaIngredientFactory</span> <span class="keyword">implements</span> <span class="title">PizzaIngredientFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cheese <span class="title">createCheese</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReggianoCheese();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Clams <span class="title">createClams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FreshClams();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dough <span class="title">createDough</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThinCrustDough();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pepperoni <span class="title">createPepperoni</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SlicedPepperoni();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Sauce <span class="title">createSauce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MarinaraSauce();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Veggies[] createVeggies() &#123;</span><br><span class="line">        Veggies veggies[] =  &#123;<span class="keyword">new</span> Garlic(),<span class="keyword">new</span> Onion(),<span class="keyword">new</span> Mushroom(),<span class="keyword">new</span> RefPepper()&#125;;</span><br><span class="line">        <span class="keyword">return</span> veggies;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>产品接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 每个披萨都持有一组在准备时会用到的原料</span><br><span class="line">     */</span></span><br><span class="line">    String name;</span><br><span class="line">    Dough dough;</span><br><span class="line">    Sauce sauce;</span><br><span class="line">    Veggies veggies[];</span><br><span class="line">    Cheese cheese;</span><br><span class="line">    Pepperoni pepperoni;</span><br><span class="line">    Clams clams;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * prepare()方法声明为抽象方法。在这个方法中，我们需要收集披萨所需要的原料，而这些原料都是来自原料工厂</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Bake for 25 munites at 350"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Cutting the pizza into diagonal slices"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">box</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Place pizza in official PizzaStore box"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>具体产品实现类</strong></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CheesePizza</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Pizza</span>&#123;</span></span><br><span class="line">    <span class="type">PizzaIngredientFactory</span> ingredientFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 要制作披萨必须要有制作披萨的原料，而这些原料是从原料工厂运来的</span><br><span class="line">     */</span></span><br><span class="line">    public <span class="type">CheesePizza</span>(<span class="type">PizzaIngredientFactory</span> ingredientFactory)&#123;</span><br><span class="line">        <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">        prepare();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 实现prepare方法</span><br><span class="line">     * prepare 方法一步一步地创建芝士比萨，每当需要原料时，就跟工厂要</span><br><span class="line">     */</span></span><br><span class="line">    void prepare() &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"Prepareing "</span> + name);</span><br><span class="line">        dough = ingredientFactory.createDough();</span><br><span class="line">        sauce = ingredientFactory.createSauce();</span><br><span class="line">        cheese = ingredientFactory.createCheese();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Clinet端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClamPizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    PizzaIngredientFactory ingredientFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClamPizza</span><span class="params">(PizzaIngredientFactory ingredientFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ingredientFactory = ingredientFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Prepare "</span> + name);</span><br><span class="line">        dough = ingredientFactory.createDough();</span><br><span class="line">        sauce = ingredientFactory.createSauce();</span><br><span class="line">        cheese = ingredientFactory.createCheese();</span><br><span class="line">        clams = ingredientFactory.createClams();      </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">        Pizza pizza;</span><br><span class="line">        pizza = createPizza(type);</span><br><span class="line">            </span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    * 创建pizza的方法交给子类去实现</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYPizzaStore</span> <span class="keyword">extends</span> <span class="title">PizzaStore</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function">Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//使用纽约的原料工厂</span></span><br><span class="line">        PizzaIngredientFactory ingredientFactory = <span class="keyword">new</span> NYPizzaIngredientFactory();   </span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"cheese"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> CheesePizza(ingredientFactory);</span><br><span class="line">            pizza.setName(<span class="string">"New York Style Cheese Pizza"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"veggie"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> VeggiePizza(ingredientFactory);</span><br><span class="line">            pizza.setName(<span class="string">"New York Style Veggie Pizza"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"clam"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> ClamPizza(ingredientFactory);</span><br><span class="line">            pizza.setName(<span class="string">"New York Style Clam Pizza"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"pepperoni"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> PepperoniPizza(ingredientFactory);</span><br><span class="line">            pizza.setName(<span class="string">"New York Style Pepperoni Pizza"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u6A21_u5F0F_u4F18_u7F3A_u70B9"><a href="#u6A21_u5F0F_u4F18_u7F3A_u70B9" class="headerlink" title="模式优缺点"></a>模式优缺点</h2><blockquote>
<p>优点</p>
<ol>
<li>抽象工厂隔离了具体类的生成，是的客户端不需要知道什么被创建。所有的具体工厂都实现了抽象工厂中定义的公共接口，因此只需要改变具体工厂的实例，就可以在某种程度上改变整个软件系统的行为</li>
<li>当一个产品族中的多个对象被设计成一起工作时，它能够保证客户端始终只使用同一个产品族中的对象<br>缺点</li>
<li>添加新的行为时比较麻烦。如果需要添加一个新产品族对象时，需要更改接口及其下所有子类，这必然会带来很大的麻烦</li>
</ol>
</blockquote>
<h2 id="u4F7F_u7528_u573A_u666F"><a href="#u4F7F_u7528_u573A_u666F" class="headerlink" title="使用场景"></a>使用场景</h2><ol>
<li>一个系统不应当依赖于产品类实例如何被创建、组合和表达的细节，这对于所有类型的工厂模式都是重要的。</li>
<li>系统中有多于一个的产品族，而每次只使用其中某一产品族。</li>
<li>属于同一个产品族的产品将在一起使用，这一约束必须在系统的设计中体现出来。</li>
<li>系统提供一个产品类的库，所有的产品以同样的接口出现，从而使客户端不依赖于具体实现。</li>
</ol>
<h2 id="u4F7F_u7528_u603B_u7ED3"><a href="#u4F7F_u7528_u603B_u7ED3" class="headerlink" title="使用总结"></a>使用总结</h2><ol>
<li>抽象工厂模式中主要的优点在于具体类的隔离，是的客户端不需要知道什么被创建了。其缺点在于增加新的等级产品结构比较复杂，需要修改接口及其所有子类</li>
</ol>
<h2 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://www.cnblogs.com/chenssy/archive/2013/06/03/3114681.html" target="_blank" rel="external">设计模式读书笔记—–抽象工厂模式</a><br><a href="http://blog.csdn.net/superbeck/article/details/4446177" target="_blank" rel="external">设计模式：简单工厂、工厂方法、抽象工厂之小结与区别</a> </p>

	
	</div>
  <a type="button" href="/2016/02/04/设计模式－抽象工厂Abstract Factory/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-02-02 </div>
			<div class="article-title"><a href="/2016/02/02/设计模式－工厂方法Factory Method/" >设计模式－工厂方法Factory Method</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="u6A21_u5F0F_u5B9A_u4E49"><a href="#u6A21_u5F0F_u5B9A_u4E49" class="headerlink" title="模式定义"></a>模式定义</h2><p>工厂方法模式定义了一个创建对象的接口，但由子类决定要实例化的类是哪一个。工厂方法模式让实例化推迟到子类。</p>
<h2 id="u6A21_u5F0F_u7ED3_u6784"><a href="#u6A21_u5F0F_u7ED3_u6784" class="headerlink" title="模式结构"></a>模式结构</h2><p><img src="http://7xqe0b.com1.z0.glb.clouddn.com/2016-02-03-14545032884011.jpg" alt=""></p>
<h2 id="u6A21_u5F0F_u5B9E_u73B0"><a href="#u6A21_u5F0F_u5B9E_u73B0" class="headerlink" title="模式实现"></a>模式实现</h2><p><strong>抽象产品类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> String name;        <span class="comment">//名称</span></span><br><span class="line">    <span class="keyword">protected</span> String dough;       <span class="comment">//面团</span></span><br><span class="line">    <span class="keyword">protected</span> String sause;       <span class="comment">//酱料</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;String&gt; toppings = <span class="keyword">new</span> ArrayList&lt;String&gt;();       <span class="comment">//佐料</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Preparing "</span>+name);</span><br><span class="line">        System.out.println(<span class="string">"Tossing dough"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Adding sause"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Adding toppings"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; toppings.size();i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">"   "</span>+toppings.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Bake for 25 minutes at 350"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Cutting the pizza into diagonal slices"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">box</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Place pizza in official PizzaStore box"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>具体产品类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYStyleCheesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NYStyleCheesePizza</span><span class="params">()</span></span>&#123;</span><br><span class="line">        name = <span class="string">"Ny Style Sauce and Cheese Pizza"</span>;</span><br><span class="line">        dough = <span class="string">"Thin Crust Dough"</span>;</span><br><span class="line">        sause = <span class="string">"Marinara Sauce"</span>;   </span><br><span class="line">        toppings.add(<span class="string">"Crated Reggiano Cheese"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChicagoStyleCheesePizza</span> <span class="keyword">extends</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChicagoStyleCheesePizza</span><span class="params">()</span></span>&#123;</span><br><span class="line">        name = <span class="string">"Chicago Style Deep Dish Cheese Pizza"</span>;</span><br><span class="line">        dough = <span class="string">"Extra Thick Crust Dough"</span>;</span><br><span class="line">        sause = <span class="string">"Plum Tomato Sauce"</span>;</span><br><span class="line">        </span><br><span class="line">        toppings.add(<span class="string">"Shredded Mozzarella Cheese"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Cutting the Pizza into square slices"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>抽象工厂</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">        Pizza pizza;</span><br><span class="line">        pizza = createPizza(type);</span><br><span class="line">        </span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 创建pizza的方法交给子类去实现</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>具体工厂</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NYPizzaStore</span> <span class="keyword">extends</span> <span class="title">PizzaStore</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function">Pizza <span class="title">createPizza</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"cheese"</span>.equals(item))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> NYStyleCheesePizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"veggie"</span>.equals(item))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> NYStyleVeggiePizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"clam"</span>.equals(item))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> NYStyleClamPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"pepperoni"</span>.equals(item))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> NYStylePepperoniPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChicagoPizzaStore</span> <span class="keyword">extends</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line">    <span class="function">Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"cheese"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> ChicagoStyleCheesePizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"clam"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> ChicagoStyleClamPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"pepperoni"</span>.equals(type)) &#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> ChicagoStylePepperoniPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"veggie"</span>.equals(type))&#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> ChicagoStyleVeggiePizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Client端</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaTestDrive</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"---------Joel 需要的芝加哥的深盘披萨---------"</span>);</span><br><span class="line">        ChicagoPizzaStore chicagoPizzaStore = <span class="keyword">new</span> ChicagoPizzaStore();       <span class="comment">//建立芝加哥的披萨店</span></span><br><span class="line">        Pizza joelPizza =chicagoPizzaStore.orderPizza(<span class="string">"cheese"</span>);             <span class="comment">//下订单</span></span><br><span class="line">        System.out.println(<span class="string">"Joel ordered a "</span> + joelPizza.getName() + <span class="string">"\n"</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"---------Ethan 需要的纽约风味的披萨---------"</span>);</span><br><span class="line">        NYPizzaStore nyPizzaStore = <span class="keyword">new</span> NYPizzaStore();</span><br><span class="line">        Pizza ethanPizza = nyPizzaStore.orderPizza(<span class="string">"cheese"</span>);</span><br><span class="line">        System.out.println(<span class="string">"Ethan ordered a "</span> + ethanPizza.getName() + <span class="string">"\n"</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u6A21_u5F0F_u4F18_u7F3A_u70B9"><a href="#u6A21_u5F0F_u4F18_u7F3A_u70B9" class="headerlink" title="模式优缺点"></a>模式优缺点</h2><blockquote>
<p>优点</p>
<ol>
<li>在工厂方法中，用户只需要知道所要产品的具体工厂，无须关系具体的创建过程，甚至不需要具体产品类的类名。</li>
<li>在系统增加新的产品时，我们只需要添加一个具体产品类和对应的实现工厂，无需对原工厂进行任何修改，很好地符合了“开闭原则”。</li>
</ol>
<p>缺点</p>
<ol>
<li>每次增加一个产品时，都需要增加一个具体类和对象实现工厂，是的系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖</li>
</ol>
</blockquote>
<h2 id="u4F7F_u7528_u573A_u666F"><a href="#u4F7F_u7528_u573A_u666F" class="headerlink" title="使用场景"></a>使用场景</h2><ol>
<li>一个类不知道它所需要的对象的类。在工厂方法模式中，我们不需要具体产品的类名，我们只需要知道创建它的具体工厂即可。<ol>
<li>一个类通过其子类来指定创建那个对象。在工厂方法模式中，对于抽象工厂类只需要提供一个创建产品的接口，而由其子类来确定具体要创建的对象，在程序运行时，子类对象将覆盖父类对象，从而使得系统更容易扩展。</li>
<li>将创建对象的任务委托给多个工厂子类中的某一个，客户端在使用时可以无须关心是哪一个工厂子类创建产品子类，需要时再动态指定</li>
</ol>
</li>
</ol>
<h2 id="u4F7F_u7528_u603B_u7ED3"><a href="#u4F7F_u7528_u603B_u7ED3" class="headerlink" title="使用总结"></a>使用总结</h2><ol>
<li>工厂方法模式完全符合“开闭原则”。</li>
<li>工厂方法模式使用继承，将对象的创建委托给子类，通过子类实现工厂方法来创建对象。</li>
<li>工厂方法允许类将实例化延伸到子类进行。</li>
<li>工厂方法让子类决定要实例化的类时哪一个。在这里我们要明白这并不是工厂来决定生成哪种产品，而是在编写创建者类时，不需要知道实际创建的产品是哪个，选择了使用哪个子类，就已经决定了实际创建的产品时哪个了。</li>
<li>在工厂方法模式中，创建者通常会包含依赖于抽象产品的代码，而这些抽象产品是、由子类创建的，创建者不需要真的知道在制作哪种具体产品</li>
</ol>
<h2 id="u53C2_u8003_u6587_u732E"><a href="#u53C2_u8003_u6587_u732E" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://www.cnblogs.com/chenssy/archive/2013/05/26/3099495.html" target="_blank" rel="external">设计模式读书笔记—–工厂方法模式</a><br><a href="http://blog.csdn.net/superbeck/article/details/4446177" target="_blank" rel="external">设计模式：简单工厂、工厂方法、抽象工厂之小结与区别</a> </p>

	
	</div>
  <a type="button" href="/2016/02/02/设计模式－工厂方法Factory Method/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/2/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Nginx/">Nginx<span>4</span></a></li>
		
			<li><a href="/categories/web开发/">web开发<span>1</span></a></li>
		
			<li><a href="/categories/数据库/">数据库<span>1</span></a></li>
		
			<li><a href="/categories/设计模式/">设计模式<span>6</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Oracle/">Oracle<span>1</span></a></li>
		
			<li><a href="/tags/Nginx/">Nginx<span>4</span></a></li>
		
			<li><a href="/tags/POI/">POI<span>1</span></a></li>
		
			<li><a href="/tags/Excel/">Excel<span>1</span></a></li>
		
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2016/03/19/JDK源码阅读-StringBuffer类/" ><i class="fa fa-file-o"></i>...</a>
      </li>
    
      <li>
        <a href="/2016/03/19/JDK源码阅读－String类/" ><i class="fa fa-file-o"></i>...</a>
      </li>
    
      <li>
        <a href="/2016/03/13/ORACLE 分析函数/" ><i class="fa fa-file-o"></i>ORACLE 分析函数...</a>
      </li>
    
      <li>
        <a href="/2016/03/09/Nginx使用指南(四)/" ><i class="fa fa-file-o"></i>Nginx使用指南(四) 反向代理与负载均衡...</a>
      </li>
    
      <li>
        <a href="/2016/03/07/Nginx使用指南(三)/" ><i class="fa fa-file-o"></i>Nginx使用指南(三) Rewrite...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/freemind/" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/wzpan" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="http://www.linkedin.com/in/hahack" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 John Doe
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
